/*! For license information please see bb16893e.24f832ef.js.LICENSE.txt */
"use strict";(self.webpackChunkbackstage_microsite=self.webpackChunkbackstage_microsite||[]).push([[538155],{652156:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>a,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>c,toc:()=>l});var r=s(474848),n=s(28453);const o={id:"http-router",title:"Http Router Service",sidebar_label:"Http Router",description:"Documentation for the Http Router service"},i=void 0,c={id:"backend-system/core-services/http-router",title:"Http Router Service",description:"Documentation for the Http Router service",source:"@site/versioned_docs/version-stable/backend-system/core-services/http-router.md",sourceDirName:"backend-system/core-services",slug:"/backend-system/core-services/http-router",permalink:"/docs/backend-system/core-services/http-router",draft:!1,unlisted:!1,editUrl:"https://github.com/backstage/backstage/edit/master/docs/versioned_docs/version-stable/backend-system/core-services/http-router.md",tags:[],version:"stable",frontMatter:{id:"http-router",title:"Http Router Service",sidebar_label:"Http Router",description:"Documentation for the Http Router service"},sidebar:"docs",previous:{title:"Http Auth",permalink:"/docs/backend-system/core-services/http-auth"},next:{title:"Identity",permalink:"/docs/backend-system/core-services/identity"}},a={},l=[{value:"Using the service",id:"using-the-service",level:2},{value:"Configuring the service",id:"configuring-the-service",level:2}];function u(e){const t={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",...(0,n.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.p,{children:"One of the most common services is the HTTP router service which is used to\nexpose HTTP endpoints for other plugins to consume."}),"\n",(0,r.jsx)(t.h2,{id:"using-the-service",children:"Using the service"}),"\n",(0,r.jsxs)(t.p,{children:["The following example shows how to register a HTTP router for the ",(0,r.jsx)(t.code,{children:"example"})," plugin.\nThis single route will be available at the ",(0,r.jsx)(t.code,{children:"/api/example/hello"})," path."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",children:"import {\n  coreServices,\n  createBackendPlugin,\n} from '@backstage/backend-plugin-api';\nimport { Router } from 'express';\n\ncreateBackendPlugin({\n  pluginId: 'example',\n  register(env) {\n    env.registerInit({\n      deps: { http: coreServices.httpRouter },\n      async init({ http }) {\n        const router = Router();\n        router.get('/hello', (_req, res) => {\n          res.status(200).json({ hello: 'world' });\n        });\n        // Registers the router at the /api/example path\n        http.use(router);\n      },\n    });\n  },\n});\n"})}),"\n",(0,r.jsx)(t.p,{children:"This service is also responsible for keeping track of the auth policies that\napply to your routes. The default policy is to require that auth is present with\nevery incoming request, and to accept both service and user credentials\n(excluding limited access tokens). You can override this while registering your\nroutes. This dangerously allows unauthenticated access on a specific route:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",children:"http.addAuthPolicy({\n  path: '/static/:id',\n  allow: 'unauthenticated',\n});\n"})}),"\n",(0,r.jsx)(t.p,{children:"Note that the path is exactly the same format as what you used in your routes,\nincluding placeholders."}),"\n",(0,r.jsx)(t.p,{children:"If your plugin uses cookie based access (which is rare), you need to allow that\nas follows:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",children:"http.addAuthPolicy({\n  path: '/static/:id',\n  allow: 'user-cookie',\n});\n"})}),"\n",(0,r.jsxs)(t.p,{children:["For those routes you will also have to specify ",(0,r.jsx)(t.code,{children:"allowLimitedAccess: true"})," when\nusing the ",(0,r.jsx)(t.a,{href:"/docs/backend-system/core-services/auth",children:(0,r.jsx)(t.code,{children:"auth"})})," and ",(0,r.jsx)(t.a,{href:"/docs/backend-system/core-services/http-auth",children:(0,r.jsx)(t.code,{children:"httpAuth"})})," services to\naccess the incoming credentials."]}),"\n",(0,r.jsx)(t.h2,{id:"configuring-the-service",children:"Configuring the service"}),"\n",(0,r.jsx)(t.p,{children:"This service does not have any configuration options."})]})}function d(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},221020:(e,t,s)=>{var r=s(296540),n=Symbol.for("react.element"),o=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,c=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,s){var r,o={},l=null,u=null;for(r in void 0!==s&&(l=""+s),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(u=t.ref),t)i.call(t,r)&&!a.hasOwnProperty(r)&&(o[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===o[r]&&(o[r]=t[r]);return{$$typeof:n,type:e,key:l,ref:u,props:o,_owner:c.current}}t.Fragment=o,t.jsx=l,t.jsxs=l},474848:(e,t,s)=>{e.exports=s(221020)},28453:(e,t,s)=>{s.d(t,{R:()=>i,x:()=>c});var r=s(296540);const n={},o=r.createContext(n);function i(e){const t=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:i(e.components),r.createElement(o.Provider,{value:t},e.children)}}}]);